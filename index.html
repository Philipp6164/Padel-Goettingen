<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Padel Göttingen</title>
  <meta name="description" content="Padel Göttingen – Kurse, Platzbuchung, News und Kontakt. Mobilfreundlich und schnell." />
  <meta name="theme-color" content="#121212" />

  <!-- Social / SEO -->
  <meta property="og:title" content="Padel Göttingen" />
  <meta property="og:description" content="Komm vorbei: Training, Liga, Platzbuchung & Events." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://philipp6164.github.io/Padel-Goettingen/assets/LOGO.png" />
  <link rel="icon" href="assets/LOGO.png?v=2" type="image/png" />
  

  <style>
    .sr-only{
  position:absolute;
  width:1px; height:1px;
  padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0);
  white-space:nowrap; border:0;
}
    .socials {
  display: flex;
  gap: 14px;
  align-items: center;
  margin-top: 8px;
}

.socials a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #1f2937;
  transition: background 0.2s ease, transform 0.2s ease;
}

.socials a:hover {
  background: var(--accent);
  transform: scale(1.1);
}

.socials img {
  width: 22px;
  height: 22px;
  filter: invert(1);
}
    /* Base & Theme */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    @media (prefers-reduced-motion: reduce) { html { scroll-behavior: auto; } }

    :root {
      --hover: #1c2433;          /* dunkles Hover-Pill */
  --glass: rgba(14,17,23,.72);
  --glass-border: rgba(255,255,255,.06);
      --bg: #0e1117;
      --panel: #141a24;
      --text: #f3f4f6;
      --muted: #9ca3af;
      --accent: #f2bc0a;     /* Grün */
      --accent-600: #f05e19;
      --ok: #21e607;
      --warn: #f59e0b;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --maxw: 1100px;
      --header-h: 64px;
    }

body {
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: radial-gradient(1000px 500px at 30% -10%, #2b0e00 0%, var(--bg) 70%);
  color: var(--text);
  line-height: 1.6;
}
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .container { width: 100%; max-width: var(--maxw); margin: 0 auto; padding: 0 16px; }
    section { padding: 44px 0; scroll-margin-top: 80px; }
header{
  position: sticky; top:0; z-index:50;
  background: var(--glass);
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--glass-border);
}

    .nav{ display:flex; align-items:center; justify-content:space-between; height:64px; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: .2px; }
    .brand img { width: 36px; height: 36px; border-radius: 50%; }

    .menu-btn{
  background: rgba(255,255,255,.04);
  border: 1px solid #2b3444;
  color: var(--text);
  padding: 10px 12px;
  border-radius: 14px;
  transition: transform .15s ease, background .2s ease, border-color .2s ease;
}
.menu-btn:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }

  nav ul{ list-style:none; padding:0; margin:0; display:none; flex-direction:column; gap:6px; }
nav.open ul{ display:flex; }

    nav a { display: block; padding: 12px 14px; border-radius: 12px; }
    nav a:hover { background: #1f2937; }

    @media (min-width: 768px) {
      .menu-btn { display: none; }
      #mainnav{
  position: fixed; top: var(--header-h); left:0; right:0;
  width:100vw;
  background: rgba(10,12,18,.98);
  border-bottom: 1px solid #1f2937;
  transform: scaleY(0); transform-origin: top;
  transition: transform .18s ease-out;
  z-index:60;
}
      #mainnav ul { display: flex !important; flex-direction: row; gap: 10px; padding: 0; }
      #mainnav li { width: auto; border: 0; }
      #mainnav a{
  position: relative;
  display:block;
  padding: 14px 16px;              /* ↑ größer als vorher */
  border-radius: 9999px;           /* Pill */
  font-size: 16px;
  font-weight: 600;
  letter-spacing: .2px;
  color: var(--text);
  text-decoration: none;
  transition: background .18s ease, transform .12s ease;
}
#mainnav.open{ transform: scaleY(1); }
#mainnav ul{ gap:0; padding: 8px 8px; }
#mainnav li + li{ border-top: 1px solid #121a28; }
#mainnav a{
  width:100%;
  padding: 18px 20px;             /* ↑ noch größer auf Mobile */
  font-size: 18px;
  border-radius: 12px;            /* im Drawer weniger „pillig“ ok */
}

/* Desktop: horizontale Pills, mehr Luft */
@media (min-width: 768px){
  #mainnav{ position: static; transform:none; background:transparent; border:0; width:auto; }
  #mainnav ul{ display:flex !important; flex-direction:row; gap: 8px; padding:0; }
  #mainnav li{ width:auto; border:0; }
  #mainnav a{ padding: 10px 14px; font-size: 15.5px; border-radius: 9999px; }
}
/* Hover-Zustand + leichte Lift-Animation */
#mainnav a:hover{ background: var(--hover); transform: translateY(-1px); }

/* Akzent-Linie (animated underline) */
#mainnav a::after{
  content:"";
  position:absolute;
  left: 16px; right: 16px; bottom: 8px;
  height: 2px;
  background: linear-gradient(90deg, var(--accent), var(--accent-600));
  border-radius: 2px;
  transform: scaleX(0);
  transform-origin: left;
  transition: transform .18s ease;
  opacity:.85;
}
#mainnav a:hover::after{ transform: scaleX(1); }

/* Active-Zustand (per Klasse .active – s. JS unten) */
#mainnav a.active{
  background: var(--hover);
  box-shadow: inset 0 0 0 1px rgba(219,232,26,.25);
}
#mainnav a.active::after{ transform: scaleX(1); }
    }
      

    h1 { font-size: clamp(26px, 6vw, 42px); line-height: 1.2; margin: 8px 0; }
    .lead { color: var(--muted); font-size: clamp(16px, 2.6vw, 18px); }
    .panel { background: var(--panel); border: 1px solid #222; border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; }

    /* HERO grid – mobile-first */
    .hero-grid { display: grid; gap: 16px; align-items: start; }
    @media (min-width: 900px) { .hero-grid { grid-template-columns: 1.2fr .8fr; align-items: center; } }

    /* Buttons */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 16px; border-radius: 12px; cursor: pointer; text-align: center; }
    .btn.primary { background: linear-gradient(135deg, var(--accent), var(--accent-600)); color: white; border: none; }
    .btn.ghost { color: var(--text); border: 1px solid #3f3f46; }
    .cta { margin-top: 16px; display: flex; gap: 10px; flex-wrap: wrap; }
    @media (max-width: 767px) { .cta .btn { flex: 1 1 100%; } }

    /* Cards & grid */
    .grid { display: grid; gap: 16px; }
    .cards { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .card { border: 1px solid #263141; border-radius: 14px; padding: 16px; background: #111826; }
    .card h3 { margin: 0 0 6px; font-size: 18px; }
    .meta { color: var(--muted); font-size: 14px; }
    @media (min-width: 640px) { .cards { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 960px) { .cards { grid-template-columns: repeat(3, 1fr); } }

    /* Tables */
    .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .table { width: 100%; border-collapse: collapse; min-width: 0; }
    .table th, .table td { border-bottom: 1px solid #222; text-align: left; padding: 10px 6px; }
    .table th { color: var(--muted); font-weight: 600; }
    @media (max-width: 420px) { .table { font-size: 14px; } }

    footer { border-top: 1px solid #222; color: var(--muted); padding: 24px 0 40px; }
    /* Uniform panel internals */
    .panel > *:first-child { margin-top: 0; }
    .panel > *:last-child { margin-bottom: 0; }
    .panel * { max-width: 100%; }
    :focus-visible { outline: 2px dashed var(--accent); outline-offset: 3px; }
    /* Mobile menu fixes */
    #mainnav { position: fixed; top: var(--header-h); left: 0; right: 0; width: 100vw; background: rgba(14,17,23,.98); border-bottom: 1px solid #222; transform: scaleY(0); transform-origin: top; transition: transform .18s ease-out; z-index: 60; }
    #mainnav.open { transform: scaleY(1); }
    #mainnav ul { display: flex; flex-direction: column; gap: 0; padding: 8px 0; margin: 0; }
    #mainnav li { width: 100%; }
    #mainnav li + li { border-top: 1px solid #222; }
    #mainnav a { width: 100%; padding: 16px; border-radius: 0; font-size: 16px; line-height: 1.2; }
    #mainnav.open { transform: scaleY(1); }
    #mainnav ul { display: flex; flex-direction: column; gap: 0; padding: 8px 0; }
    #mainnav li { width: 100%; }
    #mainnav li + li { border-top: 1px solid #222; }
    #mainnav a { width: 100%; padding: 14px 16px; border-radius: 0; font-size: 16px; line-height: 1.2; }
    @media (min-width: 768px) {
      #mainnav { position: static; transform: none; background: transparent; border: 0; }
      #mainnav ul { display: flex !important; flex-direction: row; gap: 10px; padding: 0; }
      #mainnav li { width: auto; border: 0; }
      #mainnav a { padding: 10px 12px; border-radius: 12px; width: auto; }
    }
    #menuLottie svg {
  filter: invert(50%) sepia(100%) saturate(400%) hue-rotate(10deg) brightness(1.2);
}


    .backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.4); opacity: 0; pointer-events: none; transition: opacity .18s ease; }
    .backdrop.show { opacity: 1; pointer-events: auto; }

    /* Prevent sideways scroll on mobile */
    body { overflow-x: hidden; }

    .hero {
  position: relative;
  isolation: isolate;
  background: url('assets/hintergrund.jpg') center / cover no-repeat;
  border-bottom: 1px solid #222;
}

.hero::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.75)); /* dunkles Overlay */
  z-index: -1;
}
.price-group { border: 1px solid #263141; border-radius: 14px; padding: 16px; background: #0f1522; }
.price-group h3 { margin: 0 0 8px; font-size: 18px; }
.price-row { display:flex; justify-content:space-between; align-items:baseline; gap: 12px; padding: 10px 0; border-top: 1px solid #1d2736; }
.price-row:first-of-type { border-top: none; }
.price-title { font-weight: 600; }
.price-meta { color: var(--muted); font-size: 14px; }
.price-amount { font-weight: 700; }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="#top" aria-label="Startseite – Padel Göttingen">
        <img src="assets/LOGO.png?v=3" alt="Padel-Logo" width="36" height="36" />
        <span>Padel Göttingen</span>
      </a>
     <button class="menu-btn" id="menutoggle" aria-expanded="false" aria-label="Menü öffnen">
  <span id="menuLottie" style="width:28px;height:28px;display:block;"></span>
  <span class="sr-only">Menü</span>
</button>


      <nav id="mainnav" aria-label="Hauptnavigation">
        <ul>
          <li><a href="#kurse">Kurse</a></li>
          <li><a href="#buchung">Platzbuchung</a></li>
          <li><a href="#preise">Preise</a></li>
          <li><a href="#events">Events</a></li>
          <li><a href="#ueber-uns">Über uns</a></li>
          <li><a href="#kontakt">Kontakt</a></li>
          <li><a href="#impressum">Impressum</a></li>
          <li><a href="#datenschutz">Datenschutz</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="top">
    <!-- HERO -->
    <section class="hero" id="hero">
      <div class="container hero-grid" style="overflow:hidden;">
        <div>
          <h1>Padel mit Spaß, Teamgeist & Tempo</h1>
          <p class="lead">Wir sind Padel Göttingen: Training für alle Levels, wöchentliche Matches und Turniere – mobilfreundlich alle Infos auf einen Blick.</p>
          <div class="cta">
            <a class="btn primary" href="#buchung">Platz buchen</a>
            <a class="btn ghost" href="#kurse">Zu den Kursen</a>
          </div>
        </div>
        <div class="panel">
          <h2 style="margin:0 0 6px 0;">Nächste Termine</h2>
          <p class="meta" style="margin:0 0 8px 0;">Diese Woche</p>
          <div class="table-wrap">
            <table class="table" aria-label="Nächste Termine">
              <thead><tr><th>Tag</th><th>Uhrzeit</th><th>Event</th></tr></thead>
              <tbody id="events-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- KURSE -->
    <section id="kurse">
      <div class="container">
        <div class="panel">
          <h2>Kurse</h2>
          <p class="meta">Einsteiger, Fortgeschrittene & Jugend</p>
          <div class="cards" id="kurseliste"></div>
        </div>
      </div>
    </section>

    <!-- BUCHUNG -->
    <section id="buchung">
      <div class="container">
        <div class="panel">
          <h2>Platzbuchung</h2>
          <p class="meta">Sichere dir deinen Slot. Verlinke hier eure Buchungsplattform.</p>
          <div class="grid" style="grid-template-columns: 1fr;">
            <a class="btn primary" href="https://www.ebusy.de/preise/" target="_blank" rel="noopener" aria-label="Jetzt Platz buchen">Jetzt buchen</a>
            <p class="meta">TODO: hier müssen wir dann unsere Buchungsplattform einbinden (z. B. nuLiga o. Ä.). </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PREISE -->
<section id="preise">
  <div class="container">
    <div class="panel">
      <h2>Preise</h2>
      <p class="meta">Alle Preise werden live aus unserer Datenbank geladen.</p>
      <div id="preise-wrap" class="grid" style="gap: 16px;"></div>
    </div>
  </div>
</section>

    <!-- EVENTS -->
<section id="events">
  <div class="container">
    <div class="panel">
      <h2>Events</h2>
      <p class="meta">After-Work, Turniere & Special Nights</p>
      <div class="cards" id="events-cards"></div> <!-- ⬅️ ID hinzugefügt -->
    </div>
  </div>
</section>

    <!-- ÜBER UNS -->
    <section id="ueber-uns">
      <div class="container">
        <div class="panel">
          <h2>Über uns</h2>
          <p class="meta">Wer wir sind & wofür wir stehen</p>
          <p>Padel Göttingen ist ein junger, offener Padel-Spot in der Region. Wir verbinden Sport, Community und Events – vom Anfängerkurs über After-Work Runden bis zu besonderen Abenden mit Musik & Flutlicht.</p>
          <ul class="meta" style="padding-left: 20px;">
            <li>Community-first: Jede*r findet schnell Mitspieler:innen</li>
            <li>Mobilfreundliche Infos & einfache Buchung</li>
            <li>Faire Court-Zeiten & Trainings für alle Levels</li>
          </ul>
<div style="margin-top:24px;">
  <p class="meta">Folge uns:</p>
  <div class="socials">
    <a href="https://www.instagram.com/padel_goettingen" target="_blank" rel="noopener" aria-label="Instagram">
      <img src="assets/icons/instagram.svg" alt="Instagram" />
    </a>
    <a href="https://www.facebook.com/padelgoettingen" target="_blank" rel="noopener" aria-label="Facebook">
      <img src="assets/icons/facebook.svg" alt="Facebook" />
    </a>
    <a href="https://www.tiktok.com/@padelgoettingen" target="_blank" rel="noopener" aria-label="TikTok">
      <img src="assets/icons/tiktok.svg" alt="TikTok" />
    </a>
  </div>
</div>
        </div>
      </div>
    </section>

    <!-- KONTAKT -->
    <section id="kontakt">
      <div class="container">
        <div class="panel">
          <h2>Kontakt</h2>
          <p class="meta">Fragen? Schreib uns!</p>
          <form class="grid" style="grid-template-columns: 1fr; gap: 12px; max-width: 640px;">
            <label>
              <span class="sr-only">Name</span>
              <input aria-label="Name" required name="name" placeholder="Dein Name" style="width:100%; padding:12px; border-radius:10px; border:1px solid #334155; background:#0b122b; color:var(--text);" />
            </label>
            <label>
              <span class="sr-only">E-Mail</span>
              <input aria-label="E-Mail" required type="email" name="email" placeholder="E-Mail" style="width:100%; padding:12px; border-radius:10px; border:1px solid #334155; background:#0b122b; color:var(--text);" />
            </label>
            <label>
              <span class="sr-only">Nachricht</span>
              <textarea aria-label="Nachricht" required name="message" rows="4" placeholder="Nachricht" style="width:100%; padding:12px; border-radius:10px; border:1px solid #334155; background:#0b122b; color:var(--text);"></textarea>
            </label>
            <button class="btn primary" type="submit">Absenden</button>
            <p class="meta">TODO: mailto-Link oder Formular-Service (Formspree) hinterlegen.</p>
          </form>
        </div>
      </div>
    </section>

    <!-- IMPRESSUM -->
    <section id="impressum">
      <div class="container">
        <div class="panel">
          <h2>Impressum</h2>
          <p class="meta">Angaben gemäß § 5 TMG</p>
          <address style="font-style: normal; line-height:1.8;">
            Padel Göttingen<br />
            Philipp Syring, Johannes Bodenstein<br />
            Lange-Geismar-Straße 62<br />
            37073 Göttingen
          </address>
          <p class="meta">Kontakt: <a href="mailto:info@padel-goettingen.de">info@padel-goettingen.de</a> (Nur ein Beispiel)</p>
        </div>
      </div>
    </section>

    <!-- DATENSCHUTZ (Kurz-Platzhalter) -->
    <section id="datenschutz">
      <div class="container">
        <div class="panel">
          <h2>Datenschutz</h2>
          <p class="meta">Kurzinfo</p>
          <p>Wir verarbeiten personenbezogene Daten nur, soweit dies zur Bereitstellung dieser Website, zur Kommunikation und – falls genutzt – zur Platzbuchung erforderlich ist. Ausführliche Informationen folgen in einer erweiterten Datenschutzerklärung.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div style="display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;">
        <small>© <span id="year"></span> Padel Göttingen</small>
        <small><a href="#impressum">Impressum</a> · <a href="#datenschutz">Datenschutz</a></small>
      </div>
    </div>
  </footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


  <script>
// Jahr im Footer
document.getElementById('year').textContent = new Date().getFullYear();

document.addEventListener('DOMContentLoaded', () => {
  // Elemente
  const toggle = document.getElementById('menutoggle');
  const nav    = document.getElementById('mainnav');

  // Backdrop anlegen (du hast es benutzt, aber nicht erstellt)
  const backdrop = document.createElement('div');
  backdrop.className = 'backdrop';
  document.body.appendChild(backdrop);

  // Lottie vorbereiten (falls Bibliothek oder Container fehlt -> Fallback)
  const menuContainer = document.getElementById('menuLottie');
  let menuAnim = null;
  const hasLottie = !!(window.lottie && menuContainer);

  if (hasLottie) {
    menuAnim = lottie.loadAnimation({
      container: menuContainer,
      renderer: 'svg',
      loop: false,
      autoplay: false,
      path: './assets/icons/menu.json' // Pfad prüfen (GitHub Pages: case-sensitive, relativ!)
    });
    // Startbild (Burger) sicherstellen
    menuAnim.addEventListener('DOMLoaded', () => {
      menuAnim.goToAndStop(0, true);
    });
  } else {
    // Fallback-Icon/Text, falls nötig
    if (menuContainer) menuContainer.textContent = '≡';
  }

  function playToX(){ if (menuAnim) menuAnim.playSegments([0,16], true); }
  function playToBurger(){ if (menuAnim) menuAnim.playSegments([16,28], true); }

  const openMenu = () => {
    nav.classList.add('open');
    toggle.setAttribute('aria-expanded', 'true');
    toggle.setAttribute('aria-label', 'Menü schließen');
    backdrop.classList.add('show');
    document.body.style.overflow = 'hidden';
    playToX();
  };

  const closeMenu = () => {
    nav.classList.remove('open');
    toggle.setAttribute('aria-expanded', 'false');
    toggle.setAttribute('aria-label', 'Menü öffnen');
    backdrop.classList.remove('show');
    document.body.style.overflow = '';
    playToBurger();
  };

  toggle.addEventListener('click', () => {
    nav.classList.contains('open') ? closeMenu() : openMenu();
  });
  backdrop.addEventListener('click', closeMenu);
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
  window.addEventListener('resize', () => { if (window.innerWidth >= 768) closeMenu(); });

  // Deine bestehende Anker-Scroll-Logik kann so bleiben:
  document.querySelectorAll('#mainnav a[href^="#"]').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const target = document.querySelector(link.getAttribute('href'));
      if (target) {
        const offset = document.querySelector('header').offsetHeight - 4;
        const top = target.getBoundingClientRect().top + window.scrollY - offset;
        window.scrollTo({ top, behavior: 'smooth' });
      }
      if (nav.classList.contains('open')) closeMenu();
    });
  });
});


// ===== Nach dem Laden: Immer oben starten =====
window.addEventListener('load', () => {
  if (window.location.hash) {
    history.replaceState(null, null, ' '); // entfernt den Hash aus der URL
    window.scrollTo({ top: 0, behavior: 'instant' }); // direkt nach oben
  }
});
</script>
<script type="module">
  // --- Firebase SDKs ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  // --- Deine Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDHEPPyHKPWi8bNnpjwvKOiGHrh6WuStpE",
    authDomain: "padel-goe.firebaseapp.com",
    projectId: "padel-goe",
    storageBucket: "padel-goe.firebasestorage.app",
    messagingSenderId: "241046345515",
    appId: "1:241046345515:web:75fd944fd7a0ff0df6976e",
    measurementId: "G-L9S1GHNH32"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

 // ---------- Utils ----------
const WEEKDAYS = ['So','Mo','Di','Mi','Do','Fr','Sa'];

const fmtTime = d =>
  d.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });

const fmtDate = d =>
  d.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' });

const fmtDateShort = d =>
  d.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' });

// 🔐 Escape-Helfer gegen XSS aus Firestore
function escapeHTML(s) {
  return String(s ?? '')
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}
// Nur erlaubte CSS-Farben (Hex oder CSS-Var) durchlassen
function sanitizeColor(c, fallback = 'var(--ok)') {
  if (typeof c !== 'string') return fallback;
  const ok = /^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(c) || /^var\(--[a-z-][a-z0-9-]*\)$/.test(c);
  return ok ? c : fallback;
}

// Endzeit aus Start + Dauer berechnen (Default 60 Min)
function endFrom(startDate, minutes = 60) {
  return new Date(startDate.getTime() + (Number(minutes) || 60) * 60000);
}

// Endzeit aus Dokument oder Recurrence lesen
function computeEndFromDocOrRule(startDate, docOrRule) {
  // 1) echtes Enddatum bevorzugen (Timestamp oder ISO)
  const rawEnd = docOrRule?.end;
  if (rawEnd) {
    const end = rawEnd.toDate ? rawEnd.toDate() : new Date(rawEnd);
    if (!isNaN(end)) return end;
  }
  // 2) sonst Dauerfelder akzeptieren (min)
  const dur =
    docOrRule?.durationMinutes ??
    docOrRule?.recurrence?.durationMinutes ??
    docOrRule?.duration ??
    docOrRule?.recurrence?.duration;

  return endFrom(startDate, dur ?? 60);
}

// Recurrence sauber normalisieren (Zahlen/Arrays/Timestamps)
function normRecurrence(r) {
  if (!r) return null;
  const freq   = String(r.freq || '').toUpperCase();
  const hour   = Number(r.hour ?? 0);
  const minute = Number(r.minute ?? 0);

  // weekdays kann Zahl ODER Array sein
  let weekdays = [];
  if (Array.isArray(r.weekdays)) weekdays = r.weekdays.map(n => Number(n));
  else if (r.weekdays !== undefined) weekdays = [Number(r.weekdays)];

  const monthly = r.monthly ? {
    nth:       r.monthly.nth ? Number(r.monthly.nth) : undefined,
    weekday:  (r.monthly.weekday !== undefined) ? Number(r.monthly.weekday) : undefined,
    dayOfMonth: r.monthly.dayOfMonth ? Number(r.monthly.dayOfMonth) : undefined,
  } : undefined;

  const until = r.until?.toDate ? r.until.toDate()
               : r.until ? new Date(r.until)
               : null;

  return { freq, hour, minute, weekdays, monthly, until };
}

// Hilfen für Datums-/Serienberechnung
function setTime(baseDate, h, m) {
  const d = new Date(baseDate);
  d.setHours(h ?? 0, m ?? 0, 0, 0);
  return d;
}

function getNthWeekdayOfMonth(year, month, weekday, nth) {
  const first = new Date(year, month, 1);
  const delta = (7 + weekday - first.getDay()) % 7;
  const day   = 1 + delta + (nth - 1) * 7;
  const d     = new Date(year, month, day);
  return (d.getMonth() === month) ? d : null;
}

// Serien-Expansion
function* expandWeekly(rule, start, end) {
  const { weekdays = [], hour = 0, minute = 0 } = rule;
  for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
    if (weekdays.includes(d.getDay())) yield setTime(d, hour, minute);
  }
}

function* expandMonthly(rule, start, end) {
  const { monthly = {}, hour = 0, minute = 0 } = rule;
  const startIdx = start.getFullYear() * 12 + start.getMonth();
  const endIdx   = end.getFullYear()   * 12 + end.getMonth();
  for (let idx = startIdx; idx <= endIdx; idx++) {
    const year = Math.floor(idx / 12), month = idx % 12;
    let candidate = null;

    if (monthly.dayOfMonth) {
      candidate = new Date(year, month, monthly.dayOfMonth);
    } else if (monthly.nth && monthly.weekday !== undefined) {
      candidate = getNthWeekdayOfMonth(year, month, monthly.weekday, monthly.nth);
    }

    if (!candidate) continue;
    candidate = setTime(candidate, hour, minute);
    if (candidate >= start && candidate <= end) yield candidate;
  }
}

// Serie in konkrete Daten konvertieren (Fenster + optionales „until“)
function expandRecurrence(rec, start, end) {
  const r = normRecurrence(rec);
  if (!r || !r.freq) return [];
  const effectiveEnd = r.until ? new Date(Math.min(end, r.until)) : end;

  const items = [];
  if (r.freq === 'WEEKLY') {
    for (const dt of expandWeekly(r, start, effectiveEnd)) items.push(dt);
  } else if (r.freq === 'MONTHLY') {
    for (const dt of expandMonthly(r, start, effectiveEnd)) items.push(dt);
  }
  return items;
}

// Recurrence-Text inkl. Zeitspanne und optional „bis …“
function formatRecurrence(rec) {
  const r = normRecurrence(rec);
  if (!r?.freq) return '';

  const startDummy = new Date(); // nur für Zeitformatierung
  const startTime  = setTime(startDummy, r.hour, r.minute);
  const endTime    = computeEndFromDocOrRule(startTime, { recurrence: r });

  let ruleTxt = '';
  if (r.freq === 'WEEKLY' && Array.isArray(r.weekdays) && r.weekdays.length) {
    // z.B. „Jeden Do · 18:30–19:30“ (bei mehreren: „Jeden Mo, Do · …“)
    const wds = r.weekdays.map(w => WEEKDAYS[w]).join(', ');
    ruleTxt = `Jeden ${wds} · ${fmtTime(startTime)}–${fmtTime(endTime)}`;
  } else if (r.freq === 'MONTHLY' && r.monthly) {
    if (r.monthly.dayOfMonth) {
      ruleTxt = `Jeden ${r.monthly.dayOfMonth}. · ${fmtTime(startTime)}–${fmtTime(endTime)}`;
    } else if (r.monthly.nth && r.monthly.weekday !== undefined) {
      const nthMap = {1:'1.',2:'2.',3:'3.',4:'4.',5:'5.'};
      ruleTxt = `Jeden ${nthMap[r.monthly.nth] || r.monthly.nth + '.'} ${WEEKDAYS[r.monthly.weekday]} · ${fmtTime(startTime)}–${fmtTime(endTime)}`;
    }
  }

  if (r.until) {
    const until = r.until.toDate ? r.until.toDate() : new Date(r.until);
    if (!isNaN(until)) ruleTxt += ` · bis ${fmtDateShort(until)}`;
  }
  return ruleTxt || 'Wiederkehrend';
}

// Nächste Vorkommnis eines Dokuments (einmalig oder wiederkehrend)
function nextOccurrence(doc, lookAheadDays = 90) {
  const now = new Date();
  const lookEnd = new Date(); lookEnd.setDate(lookEnd.getDate() + lookAheadDays);

  // einmalig
  if (doc.start && !doc.recurrence) {
    const dt = doc.start?.toDate ? doc.start.toDate() : new Date(doc.start);
    return dt >= now ? dt : null;
  }
  // wiederkehrend
  if (doc.recurrence) {
    const occs = expandRecurrence(doc.recurrence, now, lookEnd).sort((a,b) => a - b);
    return occs[0] || null;
  }
  return null;
}

// Firestore-Helfer (alles laden, clientseitig filtern/sortieren)
async function getDocsAll(colName) {
  const qRef = query(collection(db, colName), orderBy('title'));
  const snap = await getDocs(qRef);
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}

  // ---------- A) Nächste Termine (Events + Courses) ----------
  (async () => {
    try {
      const tbody = document.getElementById('events-table');
      if (!tbody) return;

      const windowStart = new Date();
      const windowEnd   = new Date(); windowEnd.setDate(windowEnd.getDate() + 14);

      const [events, courses] = await Promise.all([
        getDocsAll('events'),
        getDocsAll('courses')
      ]);

      const flatItems = [];

      function pushOccurrences(docs, kind) {
        for (const doc of docs) {
          // einmalig
          if (doc.start && !doc.recurrence) {
            const dt = doc.start?.toDate ? doc.start.toDate() : new Date(doc.start);
            if (dt >= windowStart && dt <= windowEnd) flatItems.push({ dt, title: doc.title || '', kind });
          }
          // wiederkehrend
          if (doc.recurrence && (doc.recurrence.freq || doc.recurrence.FREQ)) {
            const occs = expandRecurrence(doc.recurrence, windowStart, windowEnd);
            for (const dt of occs) flatItems.push({ dt, title: doc.title || '', kind });
          }
        }
      }

      pushOccurrences(events,  'Event');
      pushOccurrences(courses, 'Kurs');

      flatItems.sort((a,b) => a.dt - b.dt);
      const upcoming = flatItems.slice(0, 6);

      tbody.innerHTML = upcoming.length
        ? upcoming.map(ev => {
            const tag  = WEEKDAYS[ev.dt.getDay()];
            const zeit = fmtTime(ev.dt);
            return `<tr><td>${escapeHTML(tag)}</td><td>${escapeHTML(zeit)}</td><td>${escapeHTML(ev.title)} <span class="meta">(${escapeHTML(ev.kind)})</span></td></tr>`;
          }).join('')
        : `<tr><td colspan="3" class="meta">Keine Termine in den nächsten 14 Tagen.</td></tr>`;
    } catch (err) {
      console.error('Fehler beim Laden der nächsten Termine:', err);
    }
  })();

  // ---------- B) Events-Karten ----------
(async () => {
  try {
    const cards = document.getElementById('events-cards');
    if (!cards) return;

    const events = await getDocsAll('events');

    const cardsHtml = events.map(ev => {
      const hasRec = !!ev.recurrence && (normRecurrence(ev.recurrence)?.freq);

      if (hasRec) {
        const line = escapeHTML(formatRecurrence(ev.recurrence));
        const title = escapeHTML(ev.title || '');
        const desc  = escapeHTML(ev.description || '');
        return `
          <article class="card">
            <h3>${title}</h3>
            <p class="meta">${line}</p>
            ${desc ? `<p>${desc}</p>` : ``}
          </article>
        `;
      }

      // einmalig → konkretes Datum + Start–Ende
      const start = ev.start?.toDate ? ev.start.toDate() : (ev.start ? new Date(ev.start) : null);
      const end   = start ? computeEndFromDocOrRule(start, ev) : null;
      const line  = escapeHTML((start && end)
        ? `${fmtDate(start)} · ${fmtTime(start)}–${fmtTime(end)}`
        : 'Termin folgt');
      const title = escapeHTML(ev.title || '');
      const desc  = escapeHTML(ev.description || '');

      return `
        <article class="card">
          <h3>${title}</h3>
          <p class="meta">${line}</p>
          ${desc ? `<p>${desc}</p>` : ``}
        </article>
      `;
    }).join('');

    cards.innerHTML = cardsHtml || `<p class="meta">Aktuell sind keine Events geplant.</p>`;
  } catch (err) {
    console.error('Fehler beim Laden der Event-Karten:', err);
  }
})();



 // ---------- C) Kurse-Karten ----------
(async () => {
  try {
    const kurseliste = document.getElementById('kurseliste');
    if (!kurseliste) return;

    const snap = await getDocs(collection(db, 'courses'));

    const rows = [];

    snap.docs.forEach(d => {
      const k = { id: d.id, ...d.data() };
      const hasRec = !!k.recurrence && (normRecurrence(k.recurrence)?.freq);

      let infoLine = '';
      let sortKey  = new Date(8640000000000000); // sehr groß → nach hinten

      if (hasRec) {
        infoLine = formatRecurrence(k.recurrence);
      } else {
        const start = k.start?.toDate ? k.start.toDate() : (k.start ? new Date(k.start) : null);
        if (start && start >= new Date()) {
          const end = computeEndFromDocOrRule(start, k);
          infoLine  = `${fmtDate(start)} · ${fmtTime(start)}–${fmtTime(end)}`;
          sortKey   = start;
        } else {
          infoLine = k.info || 'Termin folgt';
        }
      }

      const statusColor = sanitizeColor(k.statusColor, 'var(--ok)');

      const title = escapeHTML(k.title || '');
      const level = escapeHTML(k.level || '');
      const info  = escapeHTML(infoLine);
      const desc  = escapeHTML(k.description || '');
      const statusText = escapeHTML(k.status || '');

      rows.push({
        when: sortKey,
        html: `
          <article class="card">
            <h3>${title}</h3>
            <p class="meta">${level ? `${level} · ` : ``}${info}</p>
            ${desc ? `<p style="margin-top:8px;">${desc}</p>` : ``}
            <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
              <span class="meta">Status:</span>
              <span style="font-size:14px; color:${statusColor}">${statusText}</span>
            </div>
          </article>
        `
      });
    });

    rows.sort((a,b) => a.when - b.when);
    kurseliste.innerHTML = rows.map(r => r.html).join('') || `<p class="meta">Aktuell keine Kurse.</p>`;
  } catch (err) {
    console.error('Fehler beim Laden der Kurse:', err);
  }
})();


  // ---------- D) Nach Reload immer oben starten (optional) ----------
  window.addEventListener('load', () => {
    if (window.location.hash) {
      history.replaceState(null, null, ' ');
      window.scrollTo({ top: 0, behavior: 'instant' });
    }
  });

// ===== E) PREISE LADEN UND RENDERN (ohne Filter) =====
  (async () => {
    try {
      const wrap = document.getElementById('preise-wrap');
      if (!wrap) return;

      // Preise holen
      const priceDocs = await getDocsAll('prices');

      const items = priceDocs
        .filter(p => p && (p.active !== false))
        .map(p => ({
          id: p.id,
          title: p.title || '',
          category: p.category || 'Allgemein',
          price: (typeof p.price === 'number') ? p.price : null,
          priceStr: p.priceStr || null,
          currency: p.currency || '€',
          unit: p.unit || '',
          notes: p.notes || '',
          sort: (typeof p.sort === 'number') ? p.sort : 1e9
        }));

      function formatAmount(it) {
        if (it.priceStr) return escapeHTML(it.priceStr);
        if (it.price == null || isNaN(it.price)) return '—';
        const num = new Intl.NumberFormat('de-DE', {
          minimumFractionDigits: (it.price % 1 ? 2 : 0),
          maximumFractionDigits: 2
        }).format(it.price);
        return escapeHTML(`${num} ${it.currency || '€'}`.trim());
      }

      function render(list) {
        // nach Kategorie gruppieren
        const byCat = new Map();
        for (const it of list) {
          if (!byCat.has(it.category)) byCat.set(it.category, []);
          byCat.get(it.category).push(it);
        }
        // sortieren innerhalb jeder Gruppe
        for (const arr of byCat.values()) {
          arr.sort((a,b) => (a.sort - b.sort) || a.title.localeCompare(b.title, 'de'));
        }
        // HTML bauen
        const html = [...byCat.entries()]
          .sort((a,b) => a[0].localeCompare(b[0], 'de'))
          .map(([cat, arr]) => {
            const rows = arr.map(it => `
              <div class="price-row">
                <div>
                  <div class="price-title">${escapeHTML(it.title)}</div>
                  ${(it.unit || it.notes) ? `<div class="price-meta">${[escapeHTML(it.unit), escapeHTML(it.notes)].filter(Boolean).join(' · ')}</div>` : ``}
                </div>
                <div class="price-amount">${formatAmount(it)}</div>
              </div>
            `).join('');
            return `
              <section class="price-group">
                <h3>${escapeHTML(cat)}</h3>
                ${rows || `<p class="meta">Keine Einträge.</p>`}
              </section>
            `;
          }).join('');

        wrap.innerHTML = html || `<p class="meta">Zurzeit sind keine Preise hinterlegt.</p>`;
      }

      render(items);
    } catch (err) {
      console.error('Fehler beim Laden der Preise:', err);
      const wrap = document.getElementById('preise-wrap');
      if (wrap) wrap.innerHTML = `<p class="meta">Preise konnten nicht geladen werden.</p>`;
    }
  })();
  
</script>



   
</body>
</html>
